@inject IEncounterProvider EncounterProvider
@inject IPartyProvider PartyProvider
@inject IMessageProvider MessageProvider
@inject NavigationManager NavManager

<h4>@encounter.Title</h4>
<p>@encounter.Description</p>

@foreach (var choice in encounter.Choices)
{
    <button @onclick="()=>HaveEncounter(choice)" class="btn btn-primary">@choice.Text</button>
}

@code {
    //TODO this should not have a party provider and shouldn't be here

    private IEncounter encounter;
    private Party party;
    protected override void OnInitialized()
    {
        party = PartyProvider.Party;
        encounter = EncounterProvider.Encounter;
    }

    private void HaveEncounter(IEncounterChoice e)
    {
        IEnumerable<string> messages = e.Choose(party, null);
        foreach (string message in messages)
        {
            MessageProvider.AddMessage(message);
        }
        MessageProvider.CallRequestRefresh();
        PartyProvider.CallRequestRefresh();
        if (party.GameOver)
        {
            NavManager.NavigateTo("gameover");
        }
    }
}
